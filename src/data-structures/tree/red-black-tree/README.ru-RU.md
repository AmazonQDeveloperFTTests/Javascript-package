# Красно-чёрное дерево

Красно-чёрное дерево в информатике своего рода самобалансирующееся бинарное дерево поиска. У каждого узла бинарного
дерева есть дополнительный атрибут, который интерпретируется как цвет узла - красный или чёрный. Эти цветовые атрибуты
используются для того, чтобы убедиться в приблизительной сбалансированности дерева в процессе добавления и удаления узлов.

Баланс достигается раскрашиванием каждого узлы дерева одним из двух цветов таким образом, чтобы удовлетворялись
определённые свойства, которые в совокупности определяют насколько дерево может разбалансировать в худшем случае. При
изменении дерева новое дерево последовательно перестраивается и перекрашивается для восстановления цветовых свойств. Эти
свойства спроектированы таким образом, чтобы перестроение и перекрашиваине могли выполняться эффективно.

Балансировка дерева не идеальна, но она достаточно хороша, чтобы гарантировать выполнение поиска за время `O(log n)`,
где `n` - общее количество элементов в дереве. Операции вставки и удаления, вместе с перестроением и перекрашиванием
также выполняются за время `O(log n)`.

Пример красно-чёрного дерева:

![Красно-чёрное деревоred-black tree](https://upload.wikimedia.org/wikipedia/commons/6/66/Red-black_tree_example.svg)

## Свойства

В дополнение к требованиям, налагаемым на бинарное дерево поиска, должно выполняться следующее:

- Каждый узле красный или чёрный
- Корень чёрный. Иногда это правило опускается. В связи с тем, что корень может менять цвет с красного на чёрный, но не
обязательно наоборот, это правило имеет небольшое влияние на анализ
- Все листья(NIL) - чёрные
- Если узел красный, то оба его потомка - чёрные
- Каждый путь от заданного узла до любого листового потомка содержит одно и то же количество чёрных узлов

Некоторые определения: количество чёрных узлов от корня до узла является **чёрной глубиной** узла; единое число чёрных
узлов во всех путях от корня до листьев называется **чёрной высотой** красно-чёрного дерева.

Эти ограничения обеспечивают критическое свойство красно-чёрных деревьев: _путь от корня до наиболее удалённого листа не
более чем в два раза длиннее, чем путь от корня до самого близкого листа_. Как следствие дерево примерно сбалансированно
по высоте.

Так как операции вставки, удаления и поиска значений в худшем случае требуют времени, пропорционального высоте дерева,
эта теоретическая верхняя граница высоты позволяет красно-чёрным деревьям быть эффективными в худшем случае, в отличие
от обычных бинарных деревьев поиска

## Балансировка при вставке

Термин дядя будем использовать для обозначения брата родительского узла, как в фамильном дереве.
При вставке узла в цветное дерево не требуется прибегать к рекурсии, так как это можно сделать за один проход. В общем
случае при вставке нового узла возможны три варианта.

- происходит изменение цвета
- требуется сделать один поворот
- требуется сделать двойной поворот

Для этого в памяти кроме текущего узла нужно хранить еще три уровня дерева: «родителя», «деда» и «прадеда» текущего узла.

![Балансировка чёрно-красного дерева](https://www.ibm.com/developerworks/ru/library/l-data_structures_09/images/figure_01.jpg)

В первом варианте у добавляемого узла (q) проверяются дочерние узлы. Если дочерние узлы - красного цвета, а добавляемый
узел – черного, то выполняется смена цветов. Необходимо также проверить на совпадение цвета 2 узла (второй и третий
варианты) - добавляемый узел (q) и его родителя (p). Если они оба красного цвета, то выполняется одиночная либо двойная
ротация.

## Ссылки

- [Википедия](https://ru.wikipedia.org/wiki/%D0%9A%D1%80%D0%B0%D1%81%D0%BD%D0%BE-%D1%87%D1%91%D1%80%D0%BD%D0%BE%D0%B5_%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BE)
- [Красно-чёрное дерево на сайте IBM](https://www.ibm.com/developerworks/ru/library/l-data_structures_09/index.html)
- [Красно-чёрное дерево на Хабре](https://habr.com/ru/post/330644/)
- [Красно-чёрное дерево в Лектории (1:02:51)](https://lectoriy.mipt.ru/lecture/CompTech-Informat-L10-Derbysh-141128.01)
